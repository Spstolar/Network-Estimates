function[ x, opt, nonopt, skipped ] = checkrandomwirings(L, k)
%takes the layer breakdown and runs NetEst on k possible connections
%of those layers

%% Some Constants
numAgents = sum(L);
layers = length(L);
skipped = 0;
connMat = zeros(numAgents);
connMat(numAgents, numAgents - L(layers - 1):numAgents - 1) = ones(1,L(layers-1));
badConn = 0; % used when we have an agent not receiving info in some layer
opt = 0;  % total number of optimal wirings
nonopt = 0;  % '' nonoptimal wirings
m = 0; %for layer induction
x = 0; %incase all flatline

for i = 1:k  % run this many samples
    for l = 1:layers-2
        if badConn == 0
            m = m + L(l);
            tempConn = zeros(L(l+1),L(l));
            
            for j = 1:L(l)
                wiringInt = randi((2^(L(l+1)))-1);
                tempConn(:,j) = convertToConnection(str2num(dec2bin(wiringInt)),L(l+1),1); %convert j to bInt to connections
            end
            
            if prod(sum(tempConn,2)) == 0
                badConn = 1;
                skipped = skipped + 1;
            else
                connMat(m + 1 : m+L(l+1) , m - L(l) + 1 : m) = tempConn
            end
        end
        
        
    end
    
    
    if badConn == 0
        [~, vari] = NetEst( connMat , L);
        diff = vari - 1/L(1);
        if (diff)^2 > .0000001
            nonopt = nonopt + 1;
        else
            opt = opt + 1;
        end
    end
    
    
    badConn = 0;
end

%skipped = totalruns - opt - nonopt
if isNaN
x = opt/(opt+nonopt);

end